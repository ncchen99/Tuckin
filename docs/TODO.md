- [x] 設計聚餐配對演算法
- [x] 設計用戶資料處理演算法
- [x] 設計通知系統
- [x] 設計定時任務
- [x] 設計餐廳推薦演算法
- [x] 後端 matching 同校配對邏輯
- [x] 修改編輯個人資料葉面的 back 提示? 尚為儲存確定要返回嗎?
- [x] 沒有聚餐的時候，才可以刪除帳號
- [x] FCM 表清理機制，trigger 刪除
- [x] notification 表清理機制，Partition Table?
- [x] 開啟 App 後 刪除通知
- [x] 真正的登出
- [x] Join 的時候可以跟 waiting 的成員配對
- [x] 儲存用餐時間供其他葉面使用 
- [x] 修改 matching API 端點的餐廳推薦產生
- [x] 串接兩階段配對到前端(booking 葉面)
- [x] 確認出席 API 端點
- [x] 確認餐廳 API 端點
- [x] 設計餐廳資料表
- [x] 設計餐廳推薦演算法
- [x] 設定 Cloudflare r2 作為圖片儲存
- [x] 設定 Google Place API key
- [x] 完成餐廳 API 端點
- [x] 串接餐廳 API 前端
- [x] 設計用戶互評資料表
- [x] 完成用戶互評 API 端點
- [x] 串接用戶互評前端
- [x] 將用戶餐廳喜好加入配對系統?
- [x] 部屬後端到 Heroku
* [x] [API] 餐廳搜尋功能，google map api
* [x] [前端] 尚未儲存，是否要儲存
* [x] [前端] 餐廳資訊業面，profile_page route
* [x] [API] 完成餐廳資訊Get功能
* [x] [API] 確保重構是可以正常運作的
* [x] [前端] 歡迎和登錄設定頁面的液面指示器對齊問題

- [x] [SQL] dining_events 新增餐廳已經確認(status 已確認?)
- [x] [API] 完成"餐廳投票功能"
    - [x] 檢查投票是否完成
    - [x] 若已完成，建立聚餐資訊 (dining_events)，設置聚餐資訊status為pending_confirmation，更改所有用戶狀態成 waiting_attendance，發送提醒，返回用戶狀態
    - [x] 若未完成，更改用戶狀態成 waiting_other_users，返回用戶狀態
    - [x] 聚餐時間計算
- [x] [API] server 端計算流程時程
- [x] [API] 修改推薦餐廳的邏輯先檢查餐廳的營業時間
- [x] 歡迎葉面加入手勢 左右
- [x] 修正動畫的比例，按鈕的位置
- [x] 統一有卡片頁面的文字排版 由左至右 Restaurant reservation
- [x] 修正 dialog 字體大小
- [x] [API] 定時更改投票狀態
    - [x] 若已完成，pass
    - [x] 若未完成，更改投票狀態，(根據投票結果)建立聚餐資訊 (dining_events)，更改所有用戶狀態，發送提醒
- [x] [前端] 選擇餐廳葉面
  - [x] 取得投票的餐廳
  - [x] 新增餐廳的呼叫，placeholder 圖片
  - [x] 點擊投票後，送出 API 投票
  - [?] 回傳的餐廳資訊建構聚餐資訊頁面
  - [x] 持久化儲存group ID event ID restaurant info ?
- [x] [前端] 取得聚餐資訊
    - [x] 取得聚餐資訊
    - [x] 持久化儲存dining_events，供 rating 頁面使用
- [x] [前端] 聚餐頁面，下面的提示區域如果餐廳尚未確認完畢顯示提示訊息否則顯示現在的訊息，這則訊息可以點擊點擊之後會跳出對話框是否愿意幫忙訂位，進入餐廳確認頁面
- [x] [前端] 進入聚餐葉面時，檢查餐廳確認是否完成
    - [x] 若已完成，pass
    - [x] 若未完成，跳出對話框，詢問是否願意幫忙確認餐廳
        - [x] 若願意，跳轉至餐廳確認頁面
        - [x] 若不願意，pass
- [x] [前端] 餐廳確認頁面(幫忙檢查營業時間，可以的話幫忙定位)
    - [x] 十分鐘跳轉功能，按這間無法重新跳轉，縱使離開APP再回來，還是惠在正確的時間重新跳轉
    - [x] 若確認，跳出輸入訂位資料的對話框，更新餐廳狀態
    - [x] 若不確認，此頁面換新餐廳，請用戶再確認一下
- [x] [前端] 評分葉面
    - [x] 進入頁面時檢查dining event 狀態，如果狀態不為completed，則跳轉至聚餐資訊葉面
    - [x] 如果查詢不到，則跳轉至預約聚餐頁面
    - [x] 取得評分資料
    - [x] 送出評分資料 
- [x] [API] 確認餐廳
    - [x] 若確認，更新餐廳狀態
    - [x] 若不確認，更新聚餐資訊，換新餐廳，返回資訊新餐廳

- [x] [前端] 定時跳出通知，提醒用戶填寫用餐回饋
- [x] [API] 定時更改狀態成 rating
- [x] [API] 刪除非必要端點
- [x] [API] 刪除週期資料 rating_sessions、restaurant_votes、matching_groups、dining_events、user_matching_info，遷移 dining_events 資料(包含 ids)
- [x] [前端] 移除素食餐廳選項
- [x] [API] [前端] 提早用餐時間到 18:00 
- [x] [API] 餐廳邏輯增加篩選餐廳是否已經永久停業
- [x] [API] 挑選餐廳，儲存餐廳推薦清單
- [x] [前端] CUJ 整合測試 v2
- [x] [API] 修正 rating 資料取得需要 gender 

- [x] [API] 修改 matching preference 的權限 只能後端更改 表現後端驗證 或是資料庫有檢查 （目前看起來資料庫有檢查）
- [x] [前端] 修正通知不會顯示的問題
- [x] [API] 修正聚餐時間計算
- [x] [API] 優化後端推薦
- [x] [前端] 選擇餐廳頁面我想推薦餐廳的卡片opencity不對
- [x] [前端] 留言版（尋人功能，或尋友密語：你也是來認識新朋友的嘛？
- [x] 開發 ios 版本
  - [x] GCP 設定 Oauth2.0
  - [x] Firebase 設定 cloud messaging
- [x] [API] 大量用戶測試 (應該沒有問題)
- [x] [前端] 音樂會暫停的問題，葉面完全窄入時暫停
- [x] [API] 聚餐出席的頁面日騎有誤
- [x] [前端] Realtime dinner info 不運作
- [x] [前端] 密語要儲存在 Supabase 
- [x] [API] 刪除聚餐資料產生等user rating遺失問題
- [x] [API] 定時 API 們加入時間檢查，並設置 api route 開關此功能
- [x] [前端] lib\screens\dinner\dinner_reservation_page.dart 要加入時間的取得是使用ntp 去取得而不是透過裝置的時間，並且使用台灣台北時間
- [x] [前端] 開發版關閉 ntp 時間取得
- [x] [前端] 餐廳預約頁面的高度需要填滿視窗高度
- [x] [前端] [API] 現在時間的計算在真正來到聚餐時間的時候會計算到下一周，需要修正
- [x] [前端] 修正通知顏色 還有出現兩次通知的問題[之後測試當中需要注意]
- [x] [前端] 登出後清除 FCM
- [x] [前端] 修正real time 有時候會取得錯誤的訊號重新再使用Database一次
- [x] [前端] 登入之後根據用戶狀態計算聚餐的時間
- [x] [前端] 聚餐預約頁面不要計算時間而是從 user status取得
- [x] [前端] realtime 與 user status去配合 (目前看起來不需要)
- [x] 設定 Cloud scheduler 定時任務
- [x] 整理需求文件、API端點、SQL表格v、邏輯流程v(deepwiki)
- [x] 完成 QA 至 Github
- [x] 完成上架所需文件，意式圖、文案、隱私政策、使用者協議
- [x] 上架 Google Play
- [x] 修正星期和日期對不起來 剩餘一小時時的錯誤 因為取消預約的頁面星期是動態計算的
- [x] 邀請朋友幫忙內測
- [x] 完成上架所需文件，意式圖、文案、隱私政策、使用者協議
- [x] 上架 App Store
- [x] 更換不吉利的封面影片
- [x] [前端] iOS google map link 不能載入
- [x] [前端] 餐廳選擇頁面輸入入網址的地方，不能夠取消
- [x] [前端] 調整晚的大小(1/2 就好)
- [x] [前端] iOS 雙重通知修復
- [x] [前端] (有重新登入，時間有調整 realtime 不 work)餐廳投票後狀態處理，跳轉到 dinner_info 頁面
- [x] [前端] 盤查時間代訂問題
- [x] [前端] 預約頁面，電話未提供不能 click
- [x] [前端] 評分頁面，Storke 字體偏大
- [x] [前端] BTN Stroke 字體偏小
- [x] [前端] 預約聚餐頁面，聚餐當天時間顯示可以預約當天的聚餐 (9/4)
- [x] [前端] page indicator 和 rating avator 顯示變扁 iPad
- [x] [前端] [API] iOS 新增 Apple id 登入
- [x] [前端] 收到通知後根據用戶狀態導航如果在前景或是點擊通知之後根據用戶狀態導航
- [x] 製作 iOS iPad 圖
- [x] 二手版文案撰寫
- [x] 二手版宣傳
- [x] 勝後擺攤宣傳
- [x] 找一個實習或打工養活自己
- [x] 同組成員查詢安全設計 SQL Policy 
- [ ] 修正real time狀態如果有更新狀態在setting page(包含3個setting page)或者是聊天室頁面則不導航 
- [x] 將晚餐資訊頁面的背景圖片移到聊天室頁面 
- [ ] 餐廳有顯示圖片的頁面快取都需要修改，Loading的動畫也要修改
- [ ] 登出需要清除圖片快取
- [~] 為什麼圖片的快取都不到24小時就沒了
- [ ] profile_setup_page 的 avatar_url 為空時 自動推薦的照片不會依照性別
- [x] [新功能] 參加名單
- [ ]  參加名單當中的滑動區域有陰影被遮擋有問題該區域需要擴大可能增加 padding
- [x] [新功能] 聊天室
- [x] 加入日期的顯示
- [x] 加入同一個使用者傳送訊息只顯示一次使用者名稱的設計
- [x] 訊息時間要是根據裝置的時區
- [ ] [新功能] 點擊群組聊天室的通知訊息開啟APP需要導航到該聊天室頁面
- [ ] 聊天室的訊息群組需要在聚餐結束後清理
- [V] 想要加大聊天室中頭貼的大小
- [ ] 上方的header bar圖片有遮擋的問題，感覺是聊天室的標題高度不夠，需要使這一個聊天室的文字和左方的back按鈕垂直位置對齊
- [V] 修正訊息從上面出來的問題，新訊息應該要顯示在容器內部的下方
- [V] 聊天室圖片沒有快取的問題(可能因為每次網址都不一樣，本地快取的紀錄方式需要修改，參考頭貼的方式)
- [V] 圖片的長寬是不是也可以快取到 SQLite 當中? 這樣子在顯示上可以先預留一個確定的高度增加使用者的體驗 不會載入之後整體的訊息高度改變而有跳動的感覺
- [V] 對方傳送訊息的時間顯示在訊息的右邊(在訊息區塊的外面)，不要在訊息的下方，並且顯示小時和分鐘就好 12 小時制，並且在訊息和訊息之間如果有跨日的話顯示日期(在畫面中左右置中)
- [V] 圖片不顯示邊框但有陰影 點擊之後可以放大，左上角一樣顯示 back按鈕點擊之後可以縮小圖片，或者是使用手勢下滑也可以
- [ ] 重新設計輸入框的樣式參考 threads
- [V] 同一個使用者在同一個聊天室內應該使用同一個頭貼(如果該使用者沒有設定頭像的路徑)，SQLite當中記錄並且確保下次開啟也是同一個頭貼
- [V] 應該顯示傳送使用者的名字在訊息框的上面(不在白色區塊內)(圖片也要)
- [V] 下排輸入區域的按鈕點擊應該要有互動效果
- [ ] 優化圖片傳送時的效果
- [ ] 畫面有變動重新渲染時圖片重新載入的問題(出現 loading 動畫) 包括在real time事件的時候
- [ ] 聊天室的投帖圖片快取機制要增強現在看起來會一直重複取得頭貼的照片應該是使用使用者ID去比對就好，聊天室的使用者頭貼目前看起來沒有使用到快取照片
- [ ] 背景圖片不要跟著移動
- [ ] 聊天室還有參加名單的使用者頭貼取消藍色的邊框直接顯示圓形頭貼就好
- [ ] 等待出席頁面的real time會影響訊息的real time應該要先取消訂閱，在設定的頁面也是一樣
 
- [ ] ```
RealtimeService: 添加聚餐事件監聽器 - ID: dinner_info_page
I/flutter (24397): 已訂閱聚餐事件：884445b2-c0da-4e52-a892-06407c40065e
I/flutter (24397): 從聚餐事件中獲取到用餐人數: 3
I/flutter (24397): 已更新用餐人數: 3
I/flutter (24397): 已更新UserStatusService中的餐廳信息: Pizza Rock Tainan 搖滾披薩 台南店
I/flutter (24397): 從 UserStatusService 獲取聚餐時間: 2025-11-13 18:00
I/flutter (24397): 從 UserStatusService 獲取取消截止時間: 2025-11-11 06:00
I/flutter (24397): 從 UserStatusService 獲取配對組ID: dc0f0491-809c-4f9d-9e91-c8d3295cc545
I/flutter (24397): 從 UserStatusService 獲取聚餐事件ID: 884445b2-c0da-4e52-a892-06407c40065e
I/flutter (24397): 從 UserStatusService 獲取餐廳信息成功
I/flutter (24397): 聚餐事件狀態: confirmed
I/flutter (24397): 餐廳資訊已更新: Pizza Rock Tainan 搖滾披薩 台南店, 披薩料理
I/flutter (24397): RealtimeService: 開始訂閱聚餐事件狀態 - 事件ID: 884445b2-c0da-4e52-a892-06407c40065e
I/flutter (24397): RealtimeService: 正在啟動聚餐事件訂閱...
I/flutter (24397): RealtimeService: 聚餐事件訂閱成功! 監聽 dining_events 表格中 id=884445b2-c0da-4e52-a892-06407c40065e 的變更
D/WindowOnBackDispatcher(24397): setTopOnBackInvokedCallback (unwrapped): io.flutter.embedding.android.FlutterActivity$1@4bebc5c
I/flutter (24397): 聊天通知已發送
I/flutter (24397): 圖片訊息已發送
```
- [ ] 聊天室的header bar和訊息區域交接處要做漸層漸變
- [ ] 修正聊天室的header bar的標題的高度文字顯示的位置對齊 header bar的垂直置中圖片顯示頁面也要
- [ ] 送出後應該不要讓介面卡住而是直接顯示在畫面上 並等待資料庫同步 (如果出錯再將前端的顯示刪除 圖片也是一樣需要刪除) 傳送中的訊息可以加入一個狀態顯示傳送中之類的
- [ ] 尚未輸入訊息之前送出按鈕應該要是disable的狀態參考(lib\components\common\image_button.dart)
- [ ] [新功能] 提醒報名聚會
- [ ] [新功能] 使用互評加入配對，減少重複的組合
- [ ] [新功能] 通知改成早上 9 點發出？
- [ ] [TODO] 寄信通知已聚餐過或是預約的用戶，服務暫停兩周以上，會在通知他們
- [ ] [TODO] 之後寄信通知用戶服務啟用，並提醒使用成大信箱登入
- [ ] [新功能] 開啟更新提醒
- [ ] [新功能] 服務狀態檢查：系統維運中，目前無法使用，或者是什麼通知?
- [x] [新功能] 聚餐群組行程後新增群組資料也就是用戶的暱稱和介紹以及頭貼
- [x] [新功能] 新增用戶的頭貼上傳選項
- [x] [新功能] 實作照片上傳的API以及照片刪除的API
- [x] [新功能] 實作照片上傳的個人資料頁面(是否需要新增預設的選項再考慮)
- [x] [新功能] 實作照片上傳前的前端壓縮(轉換為web)
- [x] 壓縮到 512 
- [x] 相機和叉叉的圖案不要使用圓形框而是直接顯示圖片參考input框的圖標顯示
- [x] image cropper
- [x] 本地暫存功能並且把圖片API請求還有loading的動畫處理寫成一份文件

- [x] 前端制作一個圖片持久化的服務專門用來持久化圖片，跟user的service還有dining service分開
- [x] 一句話介紹自己時要吸上去避免鍵盤遮擋
- [X] 保存預設頭貼
- [x] 選取圖片之后直接顯示在原本的位置 上傳失敗再移除變回預設的
- [x] 同時轉檔和獲取上傳連結
- [x] loading 動畫
- [x] 開啟之后過2秒才顯示性別正確的頭貼
- [x] 確保上傳和刪除不卡住都在背景運作就好在使用 toast 顯示
- [ ] [TODO] IG 粉專宣傳
- [ ] [新功能][考慮] 下滑到底的提示 fail.webp


** optional **
- [x] 小 bug 修正：清除資料，重新登入進入預約成功葉面，會顯示時間未定
- [x] 小 bug 修正：開啟 APP 不會清除通知[時好時壞，可能開啟前就有通知無法捕捉到，暫不處理]
- [x] 小 bug 修正：後端配對邏輯，應當處理完所有事情再更改用戶狀態並發送通知
- [x] 小 bug 修正：確認餐廳訂位葉面滾動區域 header 需加入
- [x] 小 bug 修正：確認餐廳訂位葉面下方兩個按鈕點擊後須有 loading 動畫
- [x] 小 bug 修正：確認餐廳訂位葉面 dialog 已訂位按鈕需檢查輸入資料是否正確
- [x] 小 bug 修正：提醒關聲音，屬於正常的行為，暫不處理
- [ ] 小 bug：Supabase 的 realtime 功能在舊版 Android 無法正常運作，activity檢查回到畫面的刷新頁面也沒有作用
- [x] 優化：圖片壓縮
- [x] 更新資料庫圖檔路徑
- [x] exception 說明去除exception字樣
- [x] 小 bug 修正：選擇餐廳頁面 下方圖片填滿(自動填滿剩餘空間spacer?)，需要檢查拔拔的手機
- [x] 小 bug 修正：welcome 葉面 圖片預先載入 並且在見到該葉面才播放動畫
- [x] 更改個性測驗說明 
- [x] 將每個頁面的 loading 改為更改基本資料的那種
- [x] 修正兒童聲明
- [x] 替換圖標呈扁平化的
- [x] 重新生成扁平化的 icon 
- [x] 加入飲食偏好：餐酒館，暫不加入，喝酒不好。 
- [x] 在取消預約頁面顯示聚餐日期
- [ ] 餐廳更新資料 每個月一次 確保 資料up-to-date 
- [x] 優化開啟時的動畫連貫 (05/15 暫時無法)
- [x] 修正開啟時網路錯誤的問題 (05/15 暫時跳過)
- [x] [API] 後端定時提醒用戶取消預約，暫不需要
- [ ] [前端] 將所有頁面的loading 動畫都改成 skeletonizer (極為耗時，暫不處理)
- [ ] [新功能] 設計餐廳評價功能
- [ ] [新功能] 聚餐歷史數據查詢
- [ ] [新功能] 推薦餐廳移除，取消選取時右上角出現一個叉叉
- [ ] [新功能] 餐廳移除 API ，需更新table加入包含user ID的欄位
- [v] [新功能] dining_events realtime 更新餐廳資訊頁面
- [ ] [新功能] 將用戶互評分數加入配對系統
- [ ] [新功能] 多次未到停權處理，停權的使用者狀態與前端
- [ ] [API] 停權帳號 （狀態） 

 